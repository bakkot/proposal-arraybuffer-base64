<!doctype html>
<head><meta charset="utf-8">
<title>Uint8Array to/from base64</title><script src="ecmarkup.js?cache=HRfiQC5E" defer=""></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.0.1/styles/base16/solarized-light.min.css"><link rel="stylesheet" href="ecmarkup.css"></head><body><div id="shortcuts-help">
<ul>
  <li><span>Toggle shortcuts help</span><code>?</code></li>
  <li><span>Toggle "can call user code" annotations</span><code>u</code></li>

  <li><span>Jump to search box</span><code>/</code></li>
</ul></div><div id="menu-toggle"><svg xmlns="http://www.w3.org/2000/svg" style="width:100%; height:100%; stroke:currentColor" viewBox="0 0 120 120">
      <title>Menu</title>
      <path stroke-width="10" stroke-linecap="round" d="M30,60 h60  M30,30 m0,5 h60  M30,90 m0,-5 h60"></path>
    </svg></div><div id="menu-spacer" class="menu-spacer"></div><div id="menu"><div id="menu-search"><input type="text" id="menu-search-box" placeholder="Search..."><div id="menu-search-results" class="inactive"></div></div><div id="menu-pins"><div class="menu-pane-header">Pins</div><ul id="menu-pins-list"></ul></div><div class="menu-pane-header">Table of Contents</div><div id="menu-toc"><ol class="toc"><li><span class="item-toggle-none"></span><a href="#sec-uint8array.prototype.tobase64" title="Uint8Array.prototype.toBase64 ( [ options ] )"><span class="secnum">1</span> Uint8Array.prototype.toBase64 ( [ <var>options</var> ] )</a></li><li><span class="item-toggle-none"></span><a href="#sec-uint8array.prototype.tohex" title="Uint8Array.prototype.toHex ( )"><span class="secnum">2</span> Uint8Array.prototype.toHex ( )</a></li><li><span class="item-toggle-none"></span><a href="#sec-uint8array.frombase64" title="Uint8Array.fromBase64 ( string [ , options ] )"><span class="secnum">3</span> Uint8Array.fromBase64 ( <var>string</var> [ , <var>options</var> ] )</a></li><li><span class="item-toggle-none"></span><a href="#sec-uint8array.fromhex" title="Uint8Array.fromHex ( string )"><span class="secnum">4</span> Uint8Array.fromHex ( <var>string</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-getuint8arraybytes" title="GetUint8ArrayBytes ( ta )"><span class="secnum">5</span> GetUint8ArrayBytes ( <var>ta</var> )</a></li><li><span class="item-toggle-none"></span><a href="#sec-getoptionsobject" title="GetOptionsObject ( options )"><span class="secnum">6</span> GetOptionsObject ( <var>options</var> )</a></li></ol></div></div><div id="spec-container"><h1 class="version">Stage 2 Draft / November 2, 2023</h1><h1 class="title">Uint8Array to/from base64</h1>

<div id="metadata-block">
  <h1>Contributing to this Proposal</h1>
  <p>This proposal is developed <a href="https://github.com/tc39/proposal-arraybuffer-base64">on GitHub</a>. A <a href="https://tc39.es/proposal-arraybuffer-base64/">playground is available</a> with examples and a non-production polyfill to allow direct experimentation.</p>
</div>

<emu-clause id="sec-uint8array.prototype.tobase64">
  <h1><span class="secnum">1</span> Uint8Array.prototype.toBase64 ( [ <var>options</var> ] )</h1>
  <emu-alg><ol><li>Let <var>O</var> be the <emu-val>this</emu-val> value.</li><li>Let <var>toEncode</var> be ?&nbsp;<emu-xref aoid="GetUint8ArrayBytes" id="_ref_0"><a href="#sec-getuint8arraybytes">GetUint8ArrayBytes</a></emu-xref>(<var>O</var>).</li><li>Let <var>opts</var> be ?&nbsp;<emu-xref aoid="GetOptionsObject" id="_ref_1"><a href="#sec-getoptionsobject">GetOptionsObject</a></emu-xref>(<var>options</var>).</li><li>Let <var>alphabet</var> be ?&nbsp;<emu-xref aoid="Get"><a href="https://tc39.es/ecma262/#sec-get-o-p">Get</a></emu-xref>(<var>opts</var>, <emu-val>"alphabet"</emu-val>).</li><li>If <var>alphabet</var> is <emu-val>undefined</emu-val>, set <var>alphabet</var> to <emu-val>"base64"</emu-val>.</li><li>If <var>alphabet</var> <emu-xref href="#sec-ecmascript-language-types-string-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-string-type">is not a String</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>alphabet</var> is neither <emu-val>"base64"</emu-val> nor <emu-val>"base64url"</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>alphabet</var> is <emu-val>"base64"</emu-val>, then<ol><li>Let <var>outAscii</var> be the sequence of code points which results from encoding <var>toEncode</var> according to the base64 encoding specified in section 4 of <a href="https://datatracker.ietf.org/doc/html/rfc4648">RFC 4648</a>. Padding is included.</li></ol></li><li>Else,<ol><li><emu-xref href="#assert"><a href="https://tc39.es/ecma262/#assert">Assert</a></emu-xref>: <var>alphabet</var> is <emu-val>"base64url"</emu-val>.</li><li>Let <var>outAscii</var> be the sequence of code points which results from encoding <var>toEncode</var> according to the base64url encoding specified in section 5 of <a href="https://datatracker.ietf.org/doc/html/rfc4648">RFC 4648</a>. Padding is included.</li></ol></li><li>Return <emu-xref aoid="CodePointsToString"><a href="https://tc39.es/ecma262/#sec-codepointstostring">CodePointsToString</a></emu-xref>(<var>outAscii</var>).</li></ol></emu-alg>
</emu-clause>

<emu-clause id="sec-uint8array.prototype.tohex">
  <h1><span class="secnum">2</span> Uint8Array.prototype.toHex ( )</h1>
  <emu-alg><ol><li>Let <var>O</var> be the <emu-val>this</emu-val> value.</li><li>Let <var>toEncode</var> be ?&nbsp;<emu-xref aoid="GetUint8ArrayBytes" id="_ref_2"><a href="#sec-getuint8arraybytes">GetUint8ArrayBytes</a></emu-xref>(<var>O</var>).</li><li>Let <var>out</var> be the empty String.</li><li>For each byte <var>byte</var> of <var>toEncode</var>, do<ol><li>Let <var>str</var> be <emu-xref aoid="Number::toString"><a href="https://tc39.es/ecma262/#sec-numeric-types-number-tostring">Number::toString</a></emu-xref>(<var>byte</var>, 16).</li><li>If the length of <var>str</var> is 1, set <var>str</var> to the <emu-xref href="#string-concatenation"><a href="https://tc39.es/ecma262/#string-concatenation">string-concatenation</a></emu-xref> of <emu-val>"0"</emu-val> and <var>str</var>.</li><li>Set <var>out</var> to the <emu-xref href="#string-concatenation"><a href="https://tc39.es/ecma262/#string-concatenation">string-concatenation</a></emu-xref> of <var>out</var> and <var>str</var>.</li></ol></li><li>Return <var>out</var>.</li></ol></emu-alg>
</emu-clause>

<emu-clause id="sec-uint8array.frombase64">
  <h1><span class="secnum">3</span> Uint8Array.fromBase64 ( <var>string</var> [ , <var>options</var> ] )</h1>
  <p>The <dfn id="standard-base64-alphabet" tabindex="-1">standard base64 alphabet</dfn> is a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> whose elements are the code points corresponding to every letter and number in the Unicode Basic Latin block along with <emu-val>"+"</emu-val> and <emu-val>"/"</emu-val>; that is, it is <emu-xref aoid="StringToCodePoints"><a href="https://tc39.es/ecma262/#sec-stringtocodepoints">StringToCodePoints</a></emu-xref>(<emu-val>"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</emu-val>).</p>
  <emu-alg><ol><li>If <var>string</var> <emu-xref href="#sec-ecmascript-language-types-string-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-string-type">is not a String</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>opts</var> be ?&nbsp;<emu-xref aoid="GetOptionsObject" id="_ref_3"><a href="#sec-getoptionsobject">GetOptionsObject</a></emu-xref>(<var>options</var>).</li><li>Let <var>alphabet</var> be ?&nbsp;<emu-xref aoid="Get"><a href="https://tc39.es/ecma262/#sec-get-o-p">Get</a></emu-xref>(<var>opts</var>, <emu-val>"alphabet"</emu-val>).</li><li>If <var>alphabet</var> is <emu-val>undefined</emu-val>, set <var>alphabet</var> to <emu-val>"base64"</emu-val>.</li><li>If <var>alphabet</var> <emu-xref href="#sec-ecmascript-language-types-string-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-string-type">is not a String</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</li><li>If <var>alphabet</var> is neither <emu-val>"base64"</emu-val> nor <emu-val>"base64url"</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>strict</var> be <emu-xref aoid="ToBoolean"><a href="https://tc39.es/ecma262/#sec-toboolean">ToBoolean</a></emu-xref>(? <emu-xref aoid="Get"><a href="https://tc39.es/ecma262/#sec-get-o-p">Get</a></emu-xref>(<var>opts</var>, <emu-val>"strict"</emu-val>)).</li><li>NOTE: The order of validation and decoding in the algorithm below is not observable. Implementations are encouraged to perform them in whatever order is most efficient, possibly interleaving validation and stripping whitespace with decoding, as long as the behaviour is observably equivalent.</li><li>Let <var>input</var> be <emu-xref aoid="StringToCodePoints"><a href="https://tc39.es/ecma262/#sec-stringtocodepoints">StringToCodePoints</a></emu-xref>(<var>string</var>).</li><li>If <var>alphabet</var> is <emu-val>"base64url"</emu-val>, then<ol><li>If <var>input</var> contains U+002B (PLUS SIGN) or U+002F (SOLIDUS), throw a <emu-val>SyntaxError</emu-val> exception.</li><li>Replace all occurrences of U+002D (HYPHEN-MINUS) in <var>input</var> with U+002B (PLUS SIGN).</li><li>Replace all occurrences of U+005F (LOW LINE) in <var>input</var> with U+002F (SOLIDUS).</li></ol></li><li>NOTE: When <var>strict</var> is <emu-val>false</emu-val>, the algorithm below is equivalent to the <a href="https://infra.spec.whatwg.org/#forgiving-base64-decode">forgiving-base64 decode</a> operation in HTML.</li><li>If <var>strict</var> is <emu-val>false</emu-val>, then<ol><li>Remove all occurrences of U+0009 (TAB), U+000A (LF), U+000C (FF), U+000D (CR), and U+0020 (SPACE) from <var>input</var>.</li></ol></li><li>Let <var>inputLength</var> be the length of <var>input</var>.</li><li>If <var>inputLength</var> <emu-xref aoid="modulo"><a href="https://tc39.es/ecma262/#eqn-modulo">modulo</a></emu-xref> 4 is 0, then<ol><li>If <var>input</var> is not empty and the last element of <var>input</var> is U+003D (EQUALS SIGN), then<ol><li>Remove the last element of <var>input</var>.</li><li>Set <var>inputLength</var> to <var>inputLength</var> - 1.</li><li>If <var>input</var> is not empty and the last element of <var>input</var> is U+003D (EQUALS SIGN), then<ol><li>Remove the last element of <var>input</var>.</li><li>Set <var>inputLength</var> to <var>inputLength</var> - 1.</li></ol></li></ol></li></ol></li><li>Else,<ol><li>If <var>strict</var> is <emu-val>true</emu-val>, throw a <emu-val>SyntaxError</emu-val> exception.</li></ol></li><li>If <var>input</var> contains any elements which are not also elements of the <emu-xref href="#standard-base64-alphabet" id="_ref_4"><a href="#standard-base64-alphabet">standard base64 alphabet</a></emu-xref>, throw a <emu-val>SyntaxError</emu-val> exception.</li><li>Let <var>lastChunkSize</var> be <var>inputLength</var> <emu-xref aoid="modulo"><a href="https://tc39.es/ecma262/#eqn-modulo">modulo</a></emu-xref> 4.</li><li>If <var>lastChunkSize</var> is 1, then<ol><li>Throw a <emu-val>SyntaxError</emu-val> exception.</li></ol></li><li>Else if <var>lastChunkSize</var> is 2, then<ol><li>Append U+0041 (LATIN CAPITAL LETTER A) to <var>input</var> twice.</li></ol></li><li>Else if <var>lastChunkSize</var> is 3, then<ol><li>Append U+0041 (LATIN CAPITAL LETTER A) to <var>input</var>.</li></ol></li><li>Let <var>bytes</var> be the unique (possibly empty) sequence of bytes resulting from decoding <var>input</var> as base64 (such that applying the base64 encoding specified in section 4 of <a href="https://datatracker.ietf.org/doc/html/rfc4648">RFC 4648</a> to <var>bytes</var> would produce <var>input</var>).</li><li>Let <var>byteLength</var> be the length of <var>bytes</var>.</li><li>If <var>lastChunkSize</var> is 2, then<ol><li>If <var>strict</var> is <emu-val>true</emu-val> and <var>bytes</var>[<var>byteLength</var> - 2] is not 0, throw a <emu-val>SyntaxError</emu-val> exception.</li><li>Remove the final 2 elements of <var>bytes</var>.</li><li>Set <var>byteLength</var> to <var>byteLength</var> - 2.</li></ol></li><li>Else if <var>lastChunkSize</var> is 3, then<ol><li>If <var>strict</var> is <emu-val>true</emu-val> and <var>bytes</var>[<var>byteLength</var> - 1] is not 0, throw a <emu-val>SyntaxError</emu-val> exception.</li><li>Remove the final element of <var>bytes</var>.</li><li>Set <var>byteLength</var> to <var>byteLength</var> - 1.</li></ol></li><li>Let <var>result</var> be ?&nbsp;<emu-xref aoid="AllocateTypedArray"><a href="https://tc39.es/ecma262/#sec-allocatetypedarray">AllocateTypedArray</a></emu-xref>(<emu-val>"Uint8Array"</emu-val>, <emu-xref href="#sec-typedarray-objects"><a href="https://tc39.es/ecma262/#sec-typedarray-objects">%Uint8Array%</a></emu-xref>, %Uint8Array.prototype%, <var>byteLength</var>).</li><li>Set the value at each index of <var>result</var>.<var class="field">[[ViewedArrayBuffer]]</var>.<var class="field">[[ArrayBufferData]]</var> to the value at the corresponding index of <var>bytes</var>.</li><li>Return <var>result</var>.</li></ol></emu-alg>
</emu-clause>

<emu-clause id="sec-uint8array.fromhex">
  <h1><span class="secnum">4</span> Uint8Array.fromHex ( <var>string</var> )</h1>
  <emu-alg><ol><li>If <var>string</var> <emu-xref href="#sec-ecmascript-language-types-string-type"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types-string-type">is not a String</a></emu-xref>, throw a <emu-val>TypeError</emu-val> exception.</li><li>TODO: consider stripping whitespace here.</li><li>Let <var>stringLen</var> be the length of <var>string</var>.</li><li>If <var>stringLen</var> <emu-xref aoid="modulo"><a href="https://tc39.es/ecma262/#eqn-modulo">modulo</a></emu-xref> 2 is not 0, throw a <emu-val>SyntaxError</emu-val> exception.</li><li>If <var>string</var> contains any code units which are not in <emu-val>"0123456789abcdefABCDEF"</emu-val>, throw a <emu-val>SyntaxError</emu-val> exception.</li><li>Let <var>resultLength</var> be <var>stringLen</var> / 2.</li><li>Let <var>result</var> be ?&nbsp;<emu-xref aoid="AllocateTypedArray"><a href="https://tc39.es/ecma262/#sec-allocatetypedarray">AllocateTypedArray</a></emu-xref>(<emu-val>"Uint8Array"</emu-val>, <emu-xref href="#sec-typedarray-objects"><a href="https://tc39.es/ecma262/#sec-typedarray-objects">%Uint8Array%</a></emu-xref>, %Uint8Array.prototype%, <var>resultLength</var>).</li><li>Let <var>index</var> be 0.</li><li>Repeat, while <var>index</var> &lt; <var>resultLength</var>,<ol><li>Let <var>stringIndex</var> be <var>index</var> * 2.</li><li>Let <var>hexits</var> be the <emu-xref href="#substring"><a href="https://tc39.es/ecma262/#substring">substring</a></emu-xref> of <var>string</var> from <var>stringIndex</var> to <var>stringIndex</var> + 2.</li><li>Let <var>byte</var> be the <emu-xref href="#integer"><a href="https://tc39.es/ecma262/#integer">integer</a></emu-xref> value represented by <var>hexits</var> in base-16 notation, using the letters A-F and a-f for digits with values 10 through 15.</li><li>Perform !&nbsp;<emu-xref aoid="IntegerIndexedElementSet"><a href="https://tc39.es/ecma262/#sec-integerindexedelementset">IntegerIndexedElementSet</a></emu-xref>(<var>result</var>, <emu-xref aoid="𝔽"><a href="https://tc39.es/ecma262/#𝔽">𝔽</a></emu-xref>(<var>index</var>), <emu-xref aoid="𝔽"><a href="https://tc39.es/ecma262/#𝔽">𝔽</a></emu-xref>(<var>byte</var>)).</li><li>Set <var>index</var> to <var>index</var> + 1.</li></ol></li><li>Return <var>result</var>.</li></ol></emu-alg>
</emu-clause>

<emu-clause id="sec-getuint8arraybytes" type="abstract operation" aoid="GetUint8ArrayBytes">
  <h1><span class="secnum">5</span> GetUint8ArrayBytes ( <var>ta</var> )</h1>
  <p>The abstract operation GetUint8ArrayBytes takes argument <var>ta</var> (an <emu-xref href="#sec-ecmascript-language-types"><a href="https://tc39.es/ecma262/#sec-ecmascript-language-types">ECMAScript language value</a></emu-xref>) and returns either a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">normal completion containing</a></emu-xref> a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> of <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">byte values</a></emu-xref> or a <emu-xref href="#sec-completion-record-specification-type"><a href="https://tc39.es/ecma262/#sec-completion-record-specification-type">throw completion</a></emu-xref>. It performs the following steps when called:</p>
  <emu-alg><ol><li>Perform ?&nbsp;<emu-xref aoid="RequireInternalSlot"><a href="https://tc39.es/ecma262/#sec-requireinternalslot">RequireInternalSlot</a></emu-xref>(<var>ta</var>, <var class="field">[[TypedArrayName]]</var>).</li><li>If <var>ta</var>.<var class="field">[[TypedArrayName]]</var> is not <emu-val>"Uint8Array"</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>buffer</var> be <var>ta</var>.<var class="field">[[ViewedArrayBuffer]]</var>.</li><li>If <emu-xref aoid="IsDetachedBuffer"><a href="https://tc39.es/ecma262/#sec-isdetachedbuffer">IsDetachedBuffer</a></emu-xref>(<var>buffer</var>) is <emu-val>true</emu-val>, throw a <emu-val>TypeError</emu-val> exception.</li><li>Let <var>block</var> be <var>buffer</var>.<var class="field">[[ArrayBufferData]]</var>.</li><li>Let <var>offset</var> be <var>ta</var>.<var class="field">[[ByteOffset]]</var>.</li><li>Let <var>length</var> be <var>ta</var>.<var class="field">[[ArrayLength]]</var>.</li><li>Return a <emu-xref href="#sec-list-and-record-specification-type"><a href="https://tc39.es/ecma262/#sec-list-and-record-specification-type">List</a></emu-xref> whose elements are the <emu-xref href="#sec-data-blocks"><a href="https://tc39.es/ecma262/#sec-data-blocks">byte values</a></emu-xref> in <var>block</var> starting at <var>offset</var> and continuing for a total of <var>length</var> bytes, in order.</li></ol></emu-alg>
</emu-clause>

<!-- Copied from ECMA-402/Temporal -->

<emu-clause id="sec-getoptionsobject" aoid="GetOptionsObject">
  <h1><span class="secnum">6</span> GetOptionsObject ( <var>options</var> )</h1>
  <emu-alg><ol><li>If <var>options</var> is <emu-val>undefined</emu-val>, then<ol><li>Return <emu-xref aoid="OrdinaryObjectCreate"><a href="https://tc39.es/ecma262/#sec-ordinaryobjectcreate">OrdinaryObjectCreate</a></emu-xref>(<emu-val>null</emu-val>).</li></ol></li><li>If <emu-xref aoid="Type"><a href="https://tc39.es/ecma262/#sec-ecmascript-data-types-and-values">Type</a></emu-xref>(<var>options</var>) is Object, then<ol><li>Return <var>options</var>.</li></ol></li><li>Throw a <emu-val>TypeError</emu-val> exception.</li></ol></emu-alg>
</emu-clause>
</div></body>